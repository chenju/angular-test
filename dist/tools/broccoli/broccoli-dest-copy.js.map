{"version":3,"sources":["broccoli/broccoli-dest-copy.ts"],"names":["DestCopy","DestCopy.constructor","DestCopy.rebuild"],"mappings":"AAAA,kDAAkD;AAClD,0DAA0D;AAE1D,IAAO,EAAE,WAAW,IAAI,CAAC,CAAC;AAC1B,IAAO,GAAG,WAAW,UAAU,CAAC,CAAC;AACjC,IAAO,IAAI,WAAW,MAAM,CAAC,CAAC;AAC9B,wCAAmE,2BAA2B,CAAC,CAAA;AAE/F,AAIA;;;GADG;;IAEDA,kBAAoBA,SAASA,EAAUA,SAASA,EAAUA,UAAkBA;QAAxDC,cAASA,GAATA,SAASA,CAAAA;QAAUA,cAASA,GAATA,SAASA,CAAAA;QAAUA,eAAUA,GAAVA,UAAUA,CAAQA;IAAGA,CAACA;IAGhFD,0BAAOA,GAAPA,UAAQA,QAAoBA;QAA5BE,iBAeCA;QAdCA,QAAQA,CAACA,YAAYA,CAACA,OAAOA,CAACA,UAACA,eAAeA;YAC5CA,IAAIA,YAAYA,GAAGA,IAAIA,CAACA,IAAIA,CAACA,KAAIA,CAACA,UAAUA,EAAEA,eAAeA,CAACA,CAACA;YAE/DA,IAAIA,WAAWA,GAAGA,IAAIA,CAACA,OAAOA,CAACA,YAAYA,CAACA,CAACA;YAC7CA,GAAGA,CAACA,UAAUA,CAACA,WAAWA,CAACA,CAACA;YAC5BA,GAAGA,CAACA,QAAQA,CAACA,IAAIA,CAACA,IAAIA,CAACA,KAAIA,CAACA,SAASA,EAAEA,eAAeA,CAACA,EAAEA,YAAYA,CAACA,CAACA;QACzEA,CAACA,CAACA,CAACA;QAEHA,QAAQA,CAACA,YAAYA,CAACA,OAAOA,CAACA,UAACA,eAAeA;YAC5CA,IAAIA,YAAYA,GAAGA,IAAIA,CAACA,IAAIA,CAACA,KAAIA,CAACA,UAAUA,EAAEA,eAAeA,CAACA,CAACA;YAE/DA,AACAA,0EAD0EA;YAC1EA,EAAEA,CAACA,UAAUA,CAACA,YAAYA,CAACA,CAACA;QAC9BA,CAACA,CAACA,CAACA;IACLA,CAACA;IACHF,eAACA;AAADA,CApBA,AAoBCA,IAAA;AAED,kBAAe,2CAAiB,CAAC,QAAQ,CAAC,CAAC","file":"broccoli/broccoli-dest-copy.js","sourcesContent":["/// <reference path=\"../typings/node/node.d.ts\" />\r\n/// <reference path=\"../typings/fs-extra/fs-extra.d.ts\" />\r\n\r\nimport fs = require('fs');\r\nimport fse = require('fs-extra');\r\nimport path = require('path');\r\nimport {wrapDiffingPlugin, DiffingBroccoliPlugin, DiffResult} from './diffing-broccoli-plugin';\r\n\r\n/**\r\n * Intercepts each file as it is copied to the destination tempdir,\r\n * and tees a copy to the given path outside the tmp dir.\r\n */\r\nclass DestCopy implements DiffingBroccoliPlugin {\r\n  constructor(private inputPath, private cachePath, private outputRoot: string) {}\r\n\r\n\r\n  rebuild(treeDiff: DiffResult) {\r\n    treeDiff.changedPaths.forEach((changedFilePath) => {\r\n      var destFilePath = path.join(this.outputRoot, changedFilePath);\r\n\r\n      var destDirPath = path.dirname(destFilePath);\r\n      fse.mkdirsSync(destDirPath);\r\n      fse.copySync(path.join(this.inputPath, changedFilePath), destFilePath);\r\n    });\r\n\r\n    treeDiff.removedPaths.forEach((removedFilePath) => {\r\n      var destFilePath = path.join(this.outputRoot, removedFilePath);\r\n\r\n      // TODO: what about obsolete directories? we are not cleaning those up yet\r\n      fs.unlinkSync(destFilePath);\r\n    });\r\n  }\r\n}\r\n\r\nexport default wrapDiffingPlugin(DestCopy);\r\n"],"sourceRoot":"/source/"}